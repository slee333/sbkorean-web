!function(a){var b=function(){this.options={activeClass:"active",valueSource:"index",prePopulate:null,disabled:null,cssOptions:{vertical:!1,quadratic:!1,size:"medium",picker:null,element:null,hover:null,selected:null}},this.type="inline",this.input=null,this.selector=null,this.isPressed=!1,this.lastElem="",this.mouseUpTimer,this.setEvendHandlers=function(){function b(b){var c=b.target;b.originalEvent.changedTouches&&b.originalEvent.changedTouches[0]&&(c=document.elementFromPoint(b.originalEvent.changedTouches[0].clientX,b.originalEvent.changedTouches[0].clientY)),a.isPressed&&a.lastElem!==c&&(a.hover(c),a.lastElem=c),b.preventDefault()}function c(b){a.isPressed=!1,a.mouseUpTimer=setTimeout(function(){a.isPressed=!0},100)}function d(b){a.isPressed=!1}var a=this;this.items.click(function(){a.select.call(this,a,!1)});var e=this.finishHover.bind(this);this.items.on("touchmove",b),this.items.on("touchend",e),this.selector.on("touchstart",c),this.selector.on("touchcancel",d),this.items.mousemove(b),this.items.mouseup(e),this.selector.mousedown(c),this.selector.mouseleave(d)},this.hover=function(b){a(b).hasClass("checklist")||this.select.call(a(b),this,!1)},this.finishHover=function(a){clearTimeout(this.mouseUpTimer),this.lastElem=null,this.isPressed=!1},this.select=function(c,d,e){var f;if(!a(this).attr("data-disabled")){if(f="index"===c.options.valueSource?a(this).index():"data-"===c.options.valueSource.substring(0,5)?a(this).attr(c.options.valueSource):"text"===c.options.valueSource?a(this).text():a(this).val(),c.options.isSingle)return c.clear(),a(this).siblings("."+c.options.activeClass).removeClass(),a(this).addClass(c.options.activeClass),c.addValue(this,f),void(c.options.onSelect&&"function"==typeof c.options.onSelect&&!d&&c.options.onSelect(this,f));if("undefined"!=typeof e&&e===!0||"undefined"==typeof e&&a(this).hasClass(c.options.activeClass)){if(!a(this).hasClass(c.options.activeClass))return;a(this).removeClass(),c.removeValue(this,f),b.updateClasses(a(this),c.options.activeClass),c.options.onUnselect&&"function"==typeof c.options.onUnselect&&!d&&c.options.onUnselect(this,f)}else{if(a(this).hasClass(c.options.activeClass))return;a(this).addClass(c.options.activeClass),c.addValue(this,f),b.updateClasses(a(this),c.options.activeClass),c.options.onSelect&&"function"==typeof c.options.onSelect&&!d&&c.options.onSelect(this,f)}}},this.addValue=function(b,c){if("inline"===this.type){var d=this.input.val();d&&(d+=","),d+=c,this.input.val(d)}else this.selector.find("input[value='"+a(b).attr("data-value")+"']").attr("checked",!0)},this.removeValue=function(b,c){if("inline"===this.type){var d=this.input.val();d=d.replace(","+c,"").replace(c+",","").replace(c,""),this.input.val(d)}else this.selector.find("input[value='"+a(b).attr("data-value")+"']").attr("checked",!1)},this.getValue=function(b){if("inline"===this.type)return b(this.input.val());var c=[];return this.selector.find("input[checked='checked']").each(function(b,d){c.push(a(d).val())}),b(c)},this.clear=function(){"inline"===this.type?(this.input.val(""),this.selector.find(".active").removeClass()):(this.selector.find(".active").removeClass(),this.selector.find("input").attr("checked",!1))},this.prePopulate=function(){if(b.isArray(this.options.prePopulate)&&this.options.prePopulate.length)for(var c in this.options.prePopulate){var d=this.options.prePopulate[c],e=this.getElementSelector(d);a(e).index()<0?console.warn("Multipicker: prepopulated element doesn`t found `%s`",d):this.select.call(e,this,!0)}else{var e=this.getElementSelector(this.options.prePopulate);a(e).index()<0?console.warn("Multipicker: prepopulated element doesn`t found`%s`",this.options.prePopulate):this.select.call(e,this,!0)}},this.disable=function(c,d){if(b.isArray(c)&&c.length)for(var e in c){var f=c[e],g=this.getElementSelector(f);a(g).index()<0?console.warn("Multipicker: prepopulated element doesn`t found `%s`",f):d?a(g).removeAttr("data-disabled"):a(g).attr("data-disabled",!0)}else{var g=this.getElementSelector(c);a(g).index()<0?console.warn("Multipicker: disabled element doesn`t found`%s`",c):d?a(g).removeAttr("data-disabled"):a(g).attr("data-disabled",!0)}},this.getElementSelector=function(a){return"index"!==this.options.valueSource&&this.options.valueSource?"data-"===this.options.valueSource.substring(0,5)?this.selector.find(this.options.selector+"["+this.options.valueSource+"='"+a+"']"):"text"===this.options.valueSource?this.selector.find(this.options.selector+":contains('"+a+"')"):void 0:this.items.eq(a)}};b.isArray=function(a){if("[object Array]"===Object.prototype.toString.call(a))return!0},b.updateClasses=function(b,c){a(b).hasClass(c)?a(b).next().hasClass(c)&&a(b).prev().hasClass(c)?(a(b).next().next().hasClass(c)?a(b).next().attr("class",c+" center-side"):a(b).next().attr("class",c+" right-side"),a(b).prev().prev().hasClass(c)?a(b).prev().attr("class",c+" center-side"):a(b).prev().attr("class",c+" left-side"),a(b).attr("class","active center-side")):a(b).next().hasClass(c)&&!a(b).prev().hasClass(c)?(a(b).next().next().hasClass(c)?a(b).next().attr("class",c+" center-side"):a(b).next().attr("class",c+" right-side"),a(b).attr("class","active left-side")):!a(b).next().hasClass(c)&&a(b).prev().hasClass(c)&&(a(b).prev().prev().hasClass(c)?a(b).prev().attr("class",c+" center-side"):a(b).prev().attr("class",c+" left-side"),a(b).attr("class",c+" right-side")):(a(b).next().hasClass("right-side")&&a(b).next().attr("class",c),a(b).prev().hasClass("left-side")&&a(b).prev().attr("class",c),a(b).prev().hasClass("center-side")&&a(b).prev().attr("class",c+" right-side"),a(b).next().hasClass("center-side")&&a(b).next().attr("class",c+" left-side"))},b.generateStyles=function(b,c){var d="";if(c.picker){d+="#"+b+".checklist {";for(var e in c.picker)d+=e+":"+c.picker[e]+";";d+="}"}if(c.element){d+="#"+b+" > * {";for(var e in c.element)d+=e+":"+c.element[e]+";";d+="}"}if(c.selected){d+="#"+b+" > *.active {";for(var e in c.selected)d+=e+":"+c.selected[e]+";";d+="}"}if(c.hover){d+="#"+b+" > *:hover {";for(var e in c.hover)d+=e+":"+c.hover[e]+";";d+="}"}a("head").append("<style type='text/css'>"+d+"</style>")},b.API=function(a,c,d){if(!~["select","unselect","enable","disable","clear","get"].indexOf(a))return void console.warn("Method "+a+" doesn't exist");var e=b.isArray(this)?this:[this];return e.forEach(function(e){if("function"==typeof c?d=c:b.isArray(c)||(c=[c]),"get"!==a&&"clear"!=a&&!c)return void console.warn("Empty enable/disable elements");switch(a){case"select":c.forEach(function(a){var b=e.getElementSelector(a);b.length&&e.select.call(b,e,!1,!1)});break;case"unselect":c.forEach(function(a){var b=e.getElementSelector(a);b.length&&e.select.call(b,e,!1,!0)});break;case"enable":e.disable.call(e,c,!0);break;case"disable":e.disable.call(e,c,!1);break;case"clear":e.clear();break;case"get":e.getValue(d)}}),this},a.fn.extend({multiPicker:function(c,d){if("string"!=typeof c){var e=[],f=a(this).length>1;return a(this).each(function(d,g){var h=new b;if(h.options=a.extend(h.options,c),h.selector=a(g),"checkbox"===h.options.selector||"radio"===h.options.selector?(h.type=h.options.selector,"radio"===h.type&&(h.options.isSingle=!0),h.selector.find("label").css("display","none"),h.options.disabled?b.isArray(h.options.disabled)||(h.options.disabled=[h.options.disabled]):h.options.disabled=[],a(h.selector).find("input").each(function(b,c){var d=a(c).val(),e=a("label[for='"+a(c).attr("id")+"']").text()||d;h.selector.append("<span data-value='"+d+"'>"+e+"</span>"),a(c).prop("disabled")&&h.options.disabled.push(d)}),h.items=h.selector.find("span"),h.options.valueSource="data-value",h.options.selector="span",h.options.cssOptions.vertical?h.selector.addClass("more-padded-t"):h.selector.addClass("more-padded-l")):(h.options.inputName=h.options.inputName||h.selector.attr("id"),"inline"===h.type&&(a("[name="+h.options.inputName+"]").length?h.input=a("[name="+h.options.inputName+"]"):(h.selector.after("<input type='hidden' name='"+h.options.inputName+"'>"),h.input=a("[name="+h.options.inputName+"]"))),h.items=h.selector.find(h.options.selector)),h.selector.addClass("checklist"),h.options.cssOptions.vertical&&h.selector.addClass("vertical"),h.options.cssOptions.size&&h.selector.addClass(h.options.cssOptions.size),h.options.cssOptions.quadratic&&h.selector.addClass("quadratic"),(h.options.cssOptions.picker||h.options.cssOptions.element||h.options.cssOptions.hover||h.options.cssOptions.selected)&&b.generateStyles(h.selector.attr("id"),h.options.cssOptions),h.options.prePopulate&&b.isArray(h.options.prePopulate)&&h.options.prePopulate.length>1&&h.options.isSingle)throw"Can not prePopulate more then 1 item, with `isSingle` true option";if(h.options.valueSource&&"index"===h.options.valueSource&&"text"===h.options.valueSource&&"data-"!==h.options.valueSource.substring(0,5))throw"Invalid value source";if("data-disabled"===h.options.valueSource)throw"`data-disabled` attribute is reserved, choose another name";(h.options.prePopulate||0===h.options.prePopulate)&&h.prePopulate(),(b.isArray(h.options.disabled)&&h.options.disabled.length||h.options.disabled&&!b.isArray(h.options.disabled)||0===h.options.disabled)&&h.disable(h.options.disabled,!1),h.selector.attr("ondragstart","return false"),h.setEvendHandlers(),h.options.onInit&&"function"==typeof h.options.onInit&&h.options.onInit(),f&&(h.multiPicker=b.API),e.push(h)}),e.multiPicker=b.API,e}}})}(jQuery);
